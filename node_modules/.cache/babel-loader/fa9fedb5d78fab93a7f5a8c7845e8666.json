{"ast":null,"code":"var _jsxFileName = \"/Users/souvikdas/WebstormProjects/Group-9-Fronend/src/components/chat/chats.js\";\nimport React, { useEffect, useState } from \"react\";\nimport { Button, Col, Container, Form, Row } from \"react-bootstrap\";\nimport axios from \"axios\";\nimport UserChat from \"./userText\";\nimport \"./index.css\";\n\nfunction Chats(props) {\n  const [online, setOnline] = useState([]);\n  const [topic, setTopic] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [chat, setChat] = useState([]);\n  useEffect(() => {\n    setOnline(JSON.parse(localStorage.getItem(\"online\")));\n    setTopic(localStorage.getItem(\"topic\"));\n    setEmail(localStorage.getItem(\"email\"));\n  }, []);\n\n  const handleSubmit = () => {\n    axios({\n      url: \"https://us-central1-serverless-project-283717.cloudfunctions.net/publishMessage\",\n      method: \"POST\",\n      data: {\n        topic_name: topic,\n        username: email,\n        message: message\n      }\n    }).then(res => {\n      console.log(\"IN SUCCESS\");\n      console.log(res);\n      setMessage(\"\");\n    }).catch(error => {\n      console.log(\"IN ERROR\");\n      console.log(error);\n    });\n  };\n\n  useEffect(() => {\n    axios({\n      url: \"https://do3vuuv41l.execute-api.us-east-1.amazonaws.com/login/online\",\n      method: \"GET\"\n    }).then(res => {\n      // const temp = res.data[\"message\"];\n      const onlineUser = res.data.online;\n      localStorage.setItem(\"online\", JSON.stringify(onlineUser));\n      localStorage.setItem(\"topic\", \"Process\");\n    }).catch(({\n      response\n    }) => {\n      console.log(\"IN ERROR\");\n      console.log(response);\n    });\n  }, []);\n  useEffect(() => {\n    setTimeout(() => {\n      axios({\n        url: \"https://do3vuuv41l.execute-api.us-east-1.amazonaws.com/login/online\",\n        method: \"GET\"\n      }).then(res => {\n        // const temp = res.data[\"message\"];\n        const onlineUser = res.data.online;\n        const topic = \"Process\";\n        console.log(\"IN SUCCESS\");\n        console.log(onlineUser);\n        console.log(typeof onlineUser);\n        console.log(topic);\n        let online_users = onlineUser;\n        let subscribers = [];\n        online_users.forEach(function (item) {\n          let user = item.split(\"@\")[0];\n          console.log(user);\n          subscribers.push(user);\n        });\n        console.log(subscribers);\n        console.log(typeof subscribers);\n        axios({\n          url: \"https://us-central1-serverless-project-283717.cloudfunctions.net/deleteTopic\",\n          method: \"POST\",\n          data: {\n            topic_name: \"Process\",\n            subscribers: [...subscribers]\n          }\n        }).then(res => {\n          console.log(\"IN SUCCESS\"); // console.log(res);\n          // localStorage.setItem('online', JSON.stringify(onlineUser));\n          // localStorage.setItem('topic', topic);\n\n          alert(\"Chat Session Ended\");\n          props.history.push('/');\n        }).catch(({\n          response\n        }) => {\n          console.log(\"IN SUCCESS1\");\n          console.log(response);\n          alert(\"Chat Session Ended\");\n          props.history.push('/');\n        });\n      }).catch(({\n        response\n      }) => {\n        console.log(\"IN ERROR\");\n        console.log(response);\n      });\n    }, 120000);\n  }, []);\n  useEffect(() => {\n    setInterval(() => {\n      axios({\n        url: \"https://us-central1-serverless-project-283717.cloudfunctions.net/listenMessages\",\n        method: \"POST\",\n        data: {\n          sub_id: localStorage.getItem(\"email\").split(\"@\")[0],\n          uniqueFileName: localStorage.getItem(\"topic\") + \".txt\"\n        }\n      }).then(res => {\n        let a = chat;\n\n        for (let i = 0; i < res.data.length; i++) {\n          a.push(res.data[i]);\n          console.log(\"LOG\", res.data[i]);\n        }\n\n        setChat([...a]);\n      }).catch(error => {\n        console.log(\"IN ERROR\");\n        console.log(error);\n      });\n    }, 4000);\n  }, []);\n  return /*#__PURE__*/React.createElement(Container, {\n    fluid: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    xs: \"10\",\n    style: {\n      backgroundColor: \"#FFFFFF\",\n      height: \"92.5vh\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-div pt-2 pb-2 pl-4 pr-4\",\n    style: {\n      height: \"90vh\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 21\n    }\n  }, chat.length !== 0 && chat.map(mychat => {\n    return mychat.data.length !== 0 && /*#__PURE__*/React.createElement(Row, {\n      className: \"justify-content-md-start\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(UserChat, {\n      message: mychat.data,\n      username: mychat.user,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 41\n      }\n    }));\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"m-0 pt-1 pb-1 border-div\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    xs: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter message...\",\n    onChange: e => setMessage(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 33\n    }\n  })), /*#__PURE__*/React.createElement(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"primary\",\n    onClick: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 33\n    }\n  }, \"Send\"))))), /*#__PURE__*/React.createElement(Col, {\n    xs: \"2\",\n    style: {\n      backgroundColor: \"#c1c1c1\",\n      height: \"92.5vh\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 17\n    }\n  }, online.map(user => {\n    return /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 32\n      }\n    }, user);\n  }))));\n}\n\nexport default Chats; // <Container className={\"mt-5 p-0\"} style={{ backgroundColor: \"#FFFFFF\" }}>\n//   <div className={\"chat-div pt-2 pb-2 pl-4 pr-4\"}>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"2\"} time={\"22:22\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"2\"} time={\"22:22\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"2\"} time={\"22:22\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"2\"} time={\"22:22\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//   </div>\n//   <div className={\"p-2 border-div\"}>\n//     <Row>\n//       <Col xs={11}>\n//         <Form.Control type=\"text\" placeholder=\"Enter message...\" />\n//       </Col>\n//       <Col>\n//         <Button variant=\"primary\" type=\"submit\">\n//           send\n//         </Button>\n//       </Col>\n//     </Row>\n//   </div>\n// </Container>","map":{"version":3,"sources":["/Users/souvikdas/WebstormProjects/Group-9-Fronend/src/components/chat/chats.js"],"names":["React","useEffect","useState","Button","Col","Container","Form","Row","axios","UserChat","Chats","props","online","setOnline","topic","setTopic","email","setEmail","message","setMessage","chat","setChat","JSON","parse","localStorage","getItem","handleSubmit","url","method","data","topic_name","username","then","res","console","log","catch","error","onlineUser","setItem","stringify","response","setTimeout","online_users","subscribers","forEach","item","user","split","push","alert","history","setInterval","sub_id","uniqueFileName","a","i","length","backgroundColor","height","map","mychat","e","target","value"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\nimport {Button, Col, Container, Form, Row} from \"react-bootstrap\";\nimport axios from \"axios\";\nimport UserChat from \"./userText\";\nimport \"./index.css\";\n\nfunction Chats(props) {\n    const [online, setOnline] = useState([]);\n    const [topic, setTopic] = useState(\"\");\n    const [email, setEmail] = useState(\"\");\n    const [message, setMessage] = useState(\"\");\n    const [chat, setChat] = useState([]);\n\n    useEffect(() => {\n        setOnline(JSON.parse(localStorage.getItem(\"online\")));\n        setTopic(localStorage.getItem(\"topic\"));\n        setEmail(localStorage.getItem(\"email\"));\n    }, []);\n\n    const handleSubmit = () => {\n        axios({\n            url:\n                \"https://us-central1-serverless-project-283717.cloudfunctions.net/publishMessage\",\n            method: \"POST\",\n            data: {\n                topic_name: topic,\n                username: email,\n                message: message,\n            },\n        })\n            .then((res) => {\n                console.log(\"IN SUCCESS\");\n                console.log(res);\n                setMessage(\"\");\n            })\n            .catch((error) => {\n                console.log(\"IN ERROR\");\n                console.log(error);\n            });\n    };\n    useEffect(() => {\n        axios({\n            url:\n                \"https://do3vuuv41l.execute-api.us-east-1.amazonaws.com/login/online\",\n            method: \"GET\",\n        })\n            .then((res) => {\n                // const temp = res.data[\"message\"];\n                const onlineUser = res.data.online;\n                localStorage.setItem(\"online\", JSON.stringify(onlineUser));\n                localStorage.setItem(\"topic\", \"Process\");\n            })\n            .catch(({response}) => {\n                console.log(\"IN ERROR\");\n                console.log(response);\n            });\n    }, []);\n\n    useEffect(() => {\n        setTimeout(() => {\n            axios({\n                url:\n                    \"https://do3vuuv41l.execute-api.us-east-1.amazonaws.com/login/online\",\n                method: \"GET\",\n            })\n                .then((res) => {\n                    // const temp = res.data[\"message\"];\n                    const onlineUser = res.data.online\n                    const topic = \"Process\"\n                    console.log(\"IN SUCCESS\");\n                    console.log(onlineUser);\n                    console.log(typeof (onlineUser));\n                    console.log(topic)\n                    let online_users = onlineUser;\n                    let subscribers = [];\n                    online_users.forEach(function (item) {\n                        let user = item.split(\"@\")[0];\n                        console.log(user);\n                        subscribers.push(user);\n                    });\n                    console.log(subscribers);\n                    console.log(typeof(subscribers));\n                    axios({\n                        url:\n                            \"https://us-central1-serverless-project-283717.cloudfunctions.net/deleteTopic\",\n                        method: \"POST\",\n                        data: {\n                            topic_name: \"Process\",\n                            subscribers: [...subscribers],\n                        }\n                    })\n                        .then((res) => {\n                            console.log(\"IN SUCCESS\");\n                            // console.log(res);\n                            // localStorage.setItem('online', JSON.stringify(onlineUser));\n                            // localStorage.setItem('topic', topic);\n                            alert(\"Chat Session Ended\");\n                            props.history.push('/')\n                        })\n                        .catch(({response}) => {\n                            console.log(\"IN SUCCESS1\");\n                            console.log(response);\n                            alert(\"Chat Session Ended\");\n                            props.history.push('/')\n                        });\n                })\n                .catch(({response}) => {\n                    console.log(\"IN ERROR\");\n                    console.log(response);\n                });\n        }, 120000);\n    }, []);\n    useEffect(() => {\n        setInterval(() => {\n            axios({\n                url:\n                    \"https://us-central1-serverless-project-283717.cloudfunctions.net/listenMessages\",\n                method: \"POST\",\n                data: {\n                    sub_id: localStorage.getItem(\"email\").split(\"@\")[0],\n                    uniqueFileName: localStorage.getItem(\"topic\") + \".txt\",\n                },\n            })\n                .then((res) => {\n                    let a = chat;\n                    for (let i = 0; i < res.data.length; i++) {\n                        a.push(res.data[i]);\n                        console.log(\"LOG\", res.data[i]);\n                    }\n                    setChat([...a]);\n                })\n                .catch((error) => {\n                    console.log(\"IN ERROR\");\n                    console.log(error);\n                });\n        }, 4000);\n    }, []);\n\n    return (\n        <Container fluid>\n            <Row>\n                <Col xs=\"10\" style={{backgroundColor: \"#FFFFFF\", height: \"92.5vh\"}}>\n                    <div\n                        className={\"chat-div pt-2 pb-2 pl-4 pr-4\"}\n                        style={{height: \"90vh\"}}\n                    >\n                        {chat.length !== 0 &&\n                        chat.map((mychat) => {\n                            return (\n                                mychat.data.length !== 0 && (\n                                    <Row className=\"justify-content-md-start\">\n                                        <UserChat message={mychat.data} username={mychat.user}/>\n                                    </Row>\n                                )\n                            );\n                        })}\n                    </div>\n                    <div className={\"m-0 pt-1 pb-1 border-div\"}>\n                        <Row>\n                            <Col xs={10}>\n                                <Form.Control\n                                    type=\"text\"\n                                    placeholder=\"Enter message...\"\n                                    onChange={(e) => setMessage(e.target.value)}\n                                />\n                            </Col>\n                            <Col>\n                                <Button variant=\"primary\" onClick={handleSubmit}>\n                                    Send\n                                </Button>\n                            </Col>\n                        </Row>\n                    </div>\n                </Col>\n                <Col xs=\"2\" style={{backgroundColor: \"#c1c1c1\", height: \"92.5vh\"}}>\n                    {online.map((user) => {\n                        return <li>{user}</li>;\n                    })}\n                </Col>\n            </Row>\n        </Container>\n    );\n}\n\nexport default Chats;\n\n// <Container className={\"mt-5 p-0\"} style={{ backgroundColor: \"#FFFFFF\" }}>\n//   <div className={\"chat-div pt-2 pb-2 pl-4 pr-4\"}>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"2\"} time={\"22:22\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"2\"} time={\"22:22\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"2\"} time={\"22:22\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-end\">\n//       <UserChat message={\"2\"} time={\"22:22\"} />\n//     </Row>\n//     <Row className=\"justify-content-md-start \">\n//       <OtherChat message={\"1\"} time={\"11:11\"} />\n//     </Row>\n//   </div>\n//   <div className={\"p-2 border-div\"}>\n//     <Row>\n//       <Col xs={11}>\n//         <Form.Control type=\"text\" placeholder=\"Enter message...\" />\n//       </Col>\n//       <Col>\n//         <Button variant=\"primary\" type=\"submit\">\n//           send\n//         </Button>\n//       </Col>\n//     </Row>\n//   </div>\n// </Container>\n"]},"metadata":{},"sourceType":"module"}